---
toc: menu
---

# 数组 - Array

## 什么是数组

数组是一种线性结构，是一个存储相同类型的变量所组成的一个有序集合，数组中每一个变量称为元素，每个元素都有一个对应的索引（索引从 0 开始）。数组还有另一个特点，就是在内存中是顺序存储的。 内存是由一个个连续的内存单元所组成的，每一个内存单元都对应一个地址，在内存单元中，有些被占用了，有些是空闲的。 数组中的每一个元素，都存储在内存单元中，并且这些内存单元之间紧密排列，既不能打乱存储顺序，也不能跳过某个内存单元进行存储。

> 线性表数据结构 从字面意思理解线性表数据结构是数据呈现线性存储的一种方式，有前后两个方向，数据呈一对一的关系，除头尾外，元素都是相连的。线性表数据结构还有链表、栈、队列。

![Array](https://td-dev-public.oss-cn-hangzhou.aliyuncs.com/maoyes-app/1619014497486978379)

## js 中的数组

基本上所有的语言都内置了数组这个结构，在 js 中也不例外。在 js 中数组是基于 对象来实现的，所有跟传统的数组有一些不同

典型的数组：

- 元素的数据类型相同
- 使用连续的内存存储
- 通过数字下标获取元素

js 中的数组

- 元素的数据类型可以不同
- 内存不一定是连续的（对象是随机存储的）
- 不能通过数字下标，而是通过字符串下标
- 数组可以有任何 key。

> 在内存中的存储不一定是连续的，可能根据不同环境的实现有不同的体现。在 V8 引擎中，数组有两种，一种是内存连续的快数组，一种是以堆栈存储的慢数组，快数组存储的是一些简单的数据，可以保证查询时候的性能，但是更耗费存储空间。慢数组牺牲了查询的时间节约了存储空间。引擎会根据数据的情况自动切换快慢数组。

## 数组的优缺点

### 数组的优点

由于数组定义的空间是连续的，数组可以很方便的进行遍历，同时也可以通过数组的下标进行访问例如:

```js
const a = [1, 2, 3, 4, 5, 6, 7, 8];
a[1]; // 2
```

> 同时由于数组连续的特性,遍历的时候有着一定的优势

### 数组的缺点

数组是有序的线性表，为了保证其有序，所以在对数组进行操作的时候会有更多的耗费，基本上对于数组的操作都是 O(n)复杂度的。

- 在数组中插入元素

如果我们希望在一个数组中的某一位置进行插入一个元素，由于数组是连续的，我们需要把插入位置给腾出来，需要把插入位置右侧的所有数据进行相应的后移一位，简单的说就是依次的把数组(i-1)位的值赋值给(i),再把元素赋值到指定索引上。

<center>
<img src="https://td-dev-public.oss-cn-hangzhou.aliyuncs.com/maoyes-app/1619015200254077566.png" alt="数组插入" width="400" />
</center>

```js
Array.prototype.insert = function (index, node) {
  if (index < 0 || index > this.length) {
    return undefined;
  }
  for (let i = this.length - 1; i >= index; i -= 1) {
    this[i + 1] = this[i];
  }
  this[index] = element;
  return this;
};
```

- 删除数组中元素

删除数组的逻辑跟插入类似

```js
Array.prototype.delete = function (index) {
  if (index < 0 || index > this.length) {
    return undefined;
  }
  for (let i = index; i < this.length; i += 1) {
    this[i] = this[i + 1];
  }
  this.pop();
  return this;
};
```

<center>
<img src="https://td-dev-public.oss-cn-hangzhou.aliyuncs.com/maoyes-app/1619015726909083485.png" alt="数组删除" width="400" />
</center>

我们把数组里所有的元素都左移了一位，但数组的长度依没有改变，这意味着数组中有额外的一个元素（值是 undefined）。在最后一次循环里，i+1 引用了数组里还未初始化的一个位置。在 Java、C/C+或 C#等一些语言里，这样写可能会抛出异常，因此不得不在 numbers.length-1 处停止循环。最后用 pop 方法将数组最后一位移除，也可以将数组所有不是 undefined 给赋值一个新数组。

## 多维数组

多维数组是数组的元素也为一个数组

```js
// 一个简单的多维数组
var arr = [
  [1, 2, 3],
  [4, 5, 6],
  [7, 8, 9],
];
```

多维数组的扁平化

```js
// ES6 中提供的方法flat
let a = [1, [2, 3]];
a.flat(); // [1,2,3]

// 循环
let arr1 = [1, 2, [3], [1, 2, 3, [4, [2, 3, 4]]]];
function flatten(arr) {
  while (arr.some(item => Array.isArray(item))) {
    arr = [].concat(...arr);
  }
  return arr;
}
flatten(arr1); //[1, 2, 3, 1, 2, 3, 4, 2, 3, 4]
```

## 总结

js 原本没有真正的数组，因为 js 的数组可以存放不同类型的数据，不同数据类型存储所需要的空间大小不同，这就导致用来存放数组的内存地址不可能是连续的。所以 js 的数组是按照类似哈希映射的方法存储的，这种方式的数组读写操作相对低效。

数组是编程中极重要的一种数据结构，大部分语言都原生实现了数组数据结构。js 的数组更加灵活，而且原生实现了众多数组的操作方法，这些方法要经常使用务必做到烂熟于心。
